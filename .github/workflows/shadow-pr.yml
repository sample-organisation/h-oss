on:
  pull_request_target:
    types: [opened]

jobs:
  open-pr:
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.event.pull_request.head.ref, 'from_pro') != true }}
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      
      - name: "Print github event"
        run: |
          echo "${{ github.event.head.ref }}"
          
      - name: Debug Action
        uses: hmarr/debug-action@v1.0.0
                  
      - name: "Print github event"
        run: |
          echo "${{ github.event }}"
          
      - name: "Setup copybara"
        run: |
          docker pull olivr/copybara:latest
      
      - name: "Shadow pull request"
        env:
          PR_NUMBER: ${{ github.event.number }}
          GH_USERNAME: scriptnull
          GH_CREDS: $GH_USERNAME:${{ secrets.GH_TOKEN }}
          GH_SSH_KEY: ${{ secrets.SSH_KEY }}
        run: |
          echo "this is an attack via PR NUMBER: $PR_NUMBER"
          
          touch .git-credentials
          echo "https://$GH_CREDS@api.github.com" >> .git-credentials
          echo "https://$GH_CREDS@github.com" >> .git-credentials
          
          echo $HOME
          cp .git-credentials $HOME/.git-credentials
          git clone git@github.com:sample-organisation/h-pro.git
          pushd h-pro
          ls -a
          popd
